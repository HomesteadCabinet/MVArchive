<UserControl x:Class="MVArchive.Controls.LoggingPanel"
       xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
       xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
       xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
       xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
       mc:Ignorable="d"
       d:DesignHeight="400" d:DesignWidth="600">

  <Grid>
    <Grid.RowDefinitions>
      <RowDefinition Height="Auto"/>
      <RowDefinition Height="*"/>
      <RowDefinition Height="Auto"/>
    </Grid.RowDefinitions>

    <!-- Filter Controls -->
    <GroupBox Grid.Row="0" Header="Filters" Margin="0,0,0,5">
      <Grid Margin="5">
        <Grid.ColumnDefinitions>
          <ColumnDefinition Width="Auto"/>
          <ColumnDefinition Width="120"/>
          <ColumnDefinition Width="Auto"/>
          <ColumnDefinition Width="120"/>
          <ColumnDefinition Width="Auto"/>
          <ColumnDefinition Width="*"/>
          <ColumnDefinition Width="Auto"/>
        </Grid.ColumnDefinitions>

        <TextBlock Grid.Column="0" Text="Level:" VerticalAlignment="Center" Margin="0,0,5,0"/>
        <ComboBox Grid.Column="1" x:Name="cmbLevelFilter" Margin="0,0,10,0">
          <ComboBoxItem Content="All Levels" IsSelected="True"/>
          <ComboBoxItem Content="INFO"/>
          <ComboBoxItem Content="WARN"/>
          <ComboBoxItem Content="ERROR"/>
          <ComboBoxItem Content="DEBUG"/>
          <ComboBoxItem Content="DB"/>
          <ComboBoxItem Content="ARCHIVE"/>
          <ComboBoxItem Content="SYSTEM"/>
        </ComboBox>

        <TextBlock Grid.Column="2" Text="Category:" VerticalAlignment="Center" Margin="0,0,5,0"/>
        <ComboBox Grid.Column="3" x:Name="cmbCategoryFilter" Margin="0,0,10,0">
          <ComboBoxItem Content="All Categories" IsSelected="True"/>
          <ComboBoxItem Content="Database"/>
          <ComboBoxItem Content="Archive"/>
          <ComboBoxItem Content="System"/>
        </ComboBox>

        <TextBlock Grid.Column="4" Text="Search:" VerticalAlignment="Center" Margin="0,0,5,0"/>
        <TextBox Grid.Column="5" x:Name="txtSearchFilter" Margin="0,0,0,0"
             TextChanged="TxtSearchFilter_TextChanged"/>
        <StackPanel Grid.Column="6" Orientation="Horizontal" Margin="5,0,0,0">
          <Button x:Name="btnClearLog" Content="Clear Log" Width="80" Height="25"
              Margin="0,0,5,0" Click="BtnClearLog_Click"/>
          <Button x:Name="btnExportLog" Content="Export" Width="80" Height="25"
              Click="BtnExportLog_Click"/>
        </StackPanel>
      </Grid>
    </GroupBox>

    <!-- Log Entries -->
    <GroupBox Grid.Row="1" Header="Log Entries">
      <DataGrid x:Name="dgLogEntries"
            AutoGenerateColumns="False"
            IsReadOnly="True"
            GridLinesVisibility="Horizontal"
            HeadersVisibility="Column"
            CanUserResizeRows="False"
            CanUserAddRows="False"
            CanUserDeleteRows="False"
            SelectionMode="Single"
            SelectionUnit="FullRow"
            RowHeaderWidth="0"
            AlternatingRowBackground="LightGray"
            AlternationCount="2">

        <DataGrid.Columns>
          <DataGridTextColumn Header="Time" Binding="{Binding FormattedTimestamp}" Width="100"/>
          <DataGridTextColumn Header="Level" Binding="{Binding Level}" Width="60">
            <DataGridTextColumn.ElementStyle>
              <Style TargetType="TextBlock">
                <Style.Triggers>
                  <DataTrigger Binding="{Binding Level}" Value="ERROR">
                    <Setter Property="Foreground" Value="Red"/>
                    <Setter Property="FontWeight" Value="Bold"/>
                  </DataTrigger>
                  <DataTrigger Binding="{Binding Level}" Value="WARN">
                    <Setter Property="Foreground" Value="Orange"/>
                    <Setter Property="FontWeight" Value="Bold"/>
                  </DataTrigger>
                  <DataTrigger Binding="{Binding Level}" Value="INFO">
                    <Setter Property="Foreground" Value="Blue"/>
                  </DataTrigger>
                  <DataTrigger Binding="{Binding Level}" Value="DEBUG">
                    <Setter Property="Foreground" Value="Gray"/>
                  </DataTrigger>
                  <DataTrigger Binding="{Binding Level}" Value="DB">
                    <Setter Property="Foreground" Value="Purple"/>
                  </DataTrigger>
                  <DataTrigger Binding="{Binding Level}" Value="ARCHIVE">
                    <Setter Property="Foreground" Value="Green"/>
                  </DataTrigger>
                  <DataTrigger Binding="{Binding Level}" Value="SYSTEM">
                    <Setter Property="Foreground" Value="DarkBlue"/>
                  </DataTrigger>
                </Style.Triggers>
              </Style>
            </DataGridTextColumn.ElementStyle>
          </DataGridTextColumn>
          <DataGridTextColumn Header="Category" Binding="{Binding Category}" Width="100"/>
          <DataGridTextColumn Header="Message" Binding="{Binding Message}" Width="300"/>
          <DataGridTextColumn Header="Details" Binding="{Binding Details}" Width="200"/>
        </DataGrid.Columns>
      </DataGrid>
    </GroupBox>

    <!-- Status Bar -->
    <StatusBar Grid.Row="2" Margin="0,5,0,0">
      <StatusBarItem>
        <TextBlock x:Name="txtLogStatus" Text="Ready"/>
      </StatusBarItem>
      <Separator/>
      <StatusBarItem>
        <TextBlock x:Name="txtLogCount" Text="Entries: 0"/>
      </StatusBarItem>
      <Separator/>
      <StatusBarItem>
        <TextBlock x:Name="txtFilteredCount" Text="Filtered: 0"/>
      </StatusBarItem>
    </StatusBar>
  </Grid>
</UserControl>
